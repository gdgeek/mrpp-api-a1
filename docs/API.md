# API æ¥å£æ–‡æ¡£

> æ›´æ–°æ—¶é—´: 2025-12-25

## åŸºç¡€ä¿¡æ¯

- **API ç‰ˆæœ¬**: v1
- **è®¤è¯æ–¹å¼**: JWT Bearer Tokenï¼ˆéƒ¨åˆ†æ¥å£éœ€è¦è®¤è¯ï¼‰
- **å“åº”æ ¼å¼**: JSON

---

## è®¤è¯æ¥å£ (v1/auth)

### 1. ç™»å½•

| å±æ€§     | å€¼                    |
| -------- | --------------------- |
| **è·¯ç”±** | `POST /v1/auth/login` |
| **è®¤è¯** | ä¸éœ€è¦                |

**è¯·æ±‚å‚æ•° (Body - POST)**:

| å‚æ•°å     | ç±»å‹   | å¿…å¡« | è¯´æ˜   |
| ---------- | ------ | ---- | ------ |
| `username` | string | âœ…   | ç”¨æˆ·å |
| `password` | string | âœ…   | å¯†ç    |

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "login",
  "nickname": "ç”¨æˆ·æ˜µç§°",
  "token": {
    "accessToken": "JWT access token",
    "refreshToken": "åˆ·æ–°token"
  }
}
```

**é”™è¯¯å“åº”**:

- `400 Bad Request`: `username is required` / `password is required` / `no user` / `wrong password`

---

### 2. åˆ·æ–° Token

| å±æ€§     | å€¼                      |
| -------- | ----------------------- |
| **è·¯ç”±** | `POST /v1/auth/refresh` |
| **è®¤è¯** | ä¸éœ€è¦                  |

**è¯·æ±‚å‚æ•° (Body - POST)**:

| å‚æ•°å         | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| -------------- | ------ | ---- | -------- |
| `refreshToken` | string | âœ…   | åˆ·æ–°ä»¤ç‰Œ |

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "refresh",
  "nickname": "ç”¨æˆ·æ˜µç§°",
  "token": {
    "accessToken": "æ–°çš„ JWT access token",
    "refreshToken": "æ–°çš„åˆ·æ–°token"
  }
}
```

**é”™è¯¯å“åº”**:

- `400 Bad Request`: `refreshToken is required` / `no user` / `save error`

---

## æœåŠ¡æ¥å£ (v1/server)

### 3. æµ‹è¯•æ¥å£

| å±æ€§     | å€¼                                              |
| -------- | ----------------------------------------------- |
| **è·¯ç”±** | `GET /v1/server/test` æˆ– `HEAD /v1/server/test` |
| **è®¤è¯** | ä¸éœ€è¦                                          |

**å“åº”**: `"test"` (çº¯å­—ç¬¦ä¸²)

---

### 4. è·å–å…¬å¼€åœºæ™¯åˆ—è¡¨

| å±æ€§     | å€¼                      |
| -------- | ----------------------- |
| **è·¯ç”±** | `GET /v1/server/public` |
| **è®¤è¯** | ä¸éœ€è¦                  |
| **ç¼“å­˜** | 30 ç§’                   |

**è¯·æ±‚å‚æ•° (Query)**:

| å‚æ•°å     | ç±»å‹   | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜                                |
| ---------- | ------ | ---- | ------ | ----------------------------------- |
| `pageSize` | int    | âŒ   | 15     | æ¯é¡µæ•°é‡                            |
| `page`     | int    | âŒ   | 1      | é¡µç                                 |
| `expand`   | string | âŒ   | -      | æ‰©å±•å­—æ®µï¼Œç”¨é€—å·åˆ†éš”                |
| `tags`     | string | âŒ   | -      | æ ‡ç­¾ IDï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œå¦‚ `1,2,3` |

**å¯ç”¨ expand å­—æ®µ**:

| å­—æ®µ          | ç±»å‹   | è¯´æ˜         |
| ------------- | ------ | ------------ |
| `id`          | int    | å¿«ç…§ ID      |
| `name`        | string | åœºæ™¯åç§°     |
| `description` | string | åœºæ™¯æè¿°     |
| `image`       | object | å°é¢å›¾ç‰‡å¯¹è±¡ |
| `author_id`   | int    | ä½œè€… ID      |
| `author`      | object | ä½œè€…ä¿¡æ¯å¯¹è±¡ |
| `uuid`        | string | UUID         |
| `verse_id`    | int    | åœºæ™¯ ID      |
| `code`        | string | åœºæ™¯ä»£ç      |
| `data`        | object | åœºæ™¯æ•°æ®     |
| `metas`       | array  | å…ƒæ•°æ®åˆ—è¡¨   |
| `resources`   | array  | èµ„æºåˆ—è¡¨     |
| `managers`    | array  | ç®¡ç†è€…åˆ—è¡¨   |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /v1/server/public?expand=id,name,description,image&pageSize=10&page=1
GET /v1/server/public?expand=id,name,image&tags=1,2,3
```

**å“åº”ç¤ºä¾‹** (æ•°ç»„):

```json
[
  {
    "id": 1,
    "name": "åœºæ™¯åç§°",
    "description": "åœºæ™¯æè¿°",
    "image": {
      "id": 100,
      "url": "https://example.com/image.jpg"
    }
  }
]
```

**å“åº”å¤´** (åˆ†é¡µä¿¡æ¯):

| Header                      | è¯´æ˜     |
| --------------------------- | -------- |
| `X-Pagination-Total-Count`  | æ€»æ•°     |
| `X-Pagination-Page-Count`   | æ€»é¡µæ•°   |
| `X-Pagination-Current-Page` | å½“å‰é¡µ   |
| `X-Pagination-Per-Page`     | æ¯é¡µæ•°é‡ |

---

### 5. è·å–æ‰“å¡åœºæ™¯åˆ—è¡¨

| å±æ€§     | å€¼                       |
| -------- | ------------------------ |
| **è·¯ç”±** | `GET /v1/server/checkin` |
| **è®¤è¯** | ä¸éœ€è¦                   |

**è¯·æ±‚å‚æ•° (Query)**: åŒ `public` æ¥å£ï¼ˆæ”¯æŒåˆ†é¡µå’Œ expandï¼‰

**è¯´æ˜**: è¿”å›æ ‡è®°ä¸º `checkin` å±æ€§çš„åœºæ™¯å¿«ç…§åˆ—è¡¨

---

### 6. è·å–å•ä¸ªå¿«ç…§

| å±æ€§     | å€¼                        |
| -------- | ------------------------- |
| **è·¯ç”±** | `GET /v1/server/snapshot` |
| **è®¤è¯** | ä¸éœ€è¦                    |
| **ç¼“å­˜** | 30 ç§’                     |

**è¯·æ±‚å‚æ•° (Query)**:

| å‚æ•°å     | ç±»å‹   | å¿…å¡«   | è¯´æ˜                 |
| ---------- | ------ | ------ | -------------------- |
| `id`       | int    | äºŒé€‰ä¸€ | å¿«ç…§ ID              |
| `verse_id` | int    | äºŒé€‰ä¸€ | åœºæ™¯ ID              |
| `expand`   | string | âŒ     | æ‰©å±•å­—æ®µï¼Œç”¨é€—å·åˆ†éš” |

> âš ï¸ `id` å’Œ `verse_id` å¿…é¡»æä¾›å…¶ä¸­ä¸€ä¸ª

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /v1/server/snapshot?id=1&expand=id,name,description,code,data,metas,resources
GET /v1/server/snapshot?verse_id=10&expand=id,name,image
```

**å“åº”ç¤ºä¾‹** (å•ä¸ªå¯¹è±¡):

```json
{
  "id": 1,
  "name": "åœºæ™¯åç§°",
  "description": "åœºæ™¯æè¿°",
  "code": "...",
  "data": {...},
  "metas": [...],
  "resources": [...]
}
```

**é”™è¯¯å“åº”**:

- `400 Bad Request`: `id or verse_id is required.` / `Snapshot not found.`

---

### 7. è·å–æ‰€æœ‰æ ‡ç­¾

| å±æ€§     | å€¼                    |
| -------- | --------------------- |
| **è·¯ç”±** | `GET /v1/server/tags` |
| **è®¤è¯** | ä¸éœ€è¦                |
| **ç¼“å­˜** | 30 ç§’                 |

**è¯·æ±‚å‚æ•° (Query)**: æ”¯æŒåˆ†é¡µå‚æ•° (`pageSize`, `page`)

**å“åº”ç¤ºä¾‹** (æ•°ç»„):

```json
[
  {
    "id": 1,
    "name": "æ ‡ç­¾åç§°",
    "key": "tag_key",
    "type": "Classify"
  }
]
```

**è¯´æ˜**: åªè¿”å› `type` ä¸º `Classify` çš„æ ‡ç­¾

---

### 8. è·å–ç§æœ‰åœºæ™¯åˆ—è¡¨ ğŸ”’

| å±æ€§     | å€¼                       |
| -------- | ------------------------ |
| **è·¯ç”±** | `GET /v1/server/private` |
| **è®¤è¯** | âœ… éœ€è¦ JWT Token        |
| **ç¼“å­˜** | 30 ç§’                    |

**è¯·æ±‚å‚æ•° (Query)**: åŒ `public` æ¥å£ï¼ˆæ”¯æŒ `pageSize`, `page`, `expand`, `tags`ï¼‰

**è¯´æ˜**: è¿”å›å½“å‰ç™»å½•ç”¨æˆ·åˆ›å»ºçš„åœºæ™¯

**é”™è¯¯å“åº”**:

- `401 Unauthorized`: æœªæä¾›æœ‰æ•ˆ Token

---

### 9. è·å–ç»„åœºæ™¯åˆ—è¡¨ ğŸ”’

| å±æ€§     | å€¼                     |
| -------- | ---------------------- |
| **è·¯ç”±** | `GET /v1/server/group` |
| **è®¤è¯** | âœ… éœ€è¦ JWT Token      |
| **ç¼“å­˜** | 30 ç§’                  |

**è¯·æ±‚å‚æ•° (Query)**:

| å‚æ•°å     | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜     |
| ---------- | ---- | ---- | ------ | -------- |
| `pageSize` | int  | âŒ   | 15     | æ¯é¡µæ•°é‡ |
| `page`     | int  | âŒ   | 1      | é¡µç      |

**è¯´æ˜**: è¿”å›å½“å‰ç”¨æˆ·æ‰€å±ç»„çš„æ‰€æœ‰åœºæ™¯å¿«ç…§

**é”™è¯¯å“åº”**:

- `401 Unauthorized`: æœªæä¾›æœ‰æ•ˆ Token

---

## è®¤è¯è¯´æ˜

éœ€è¦è®¤è¯çš„æ¥å£ï¼ˆæ ‡è®° ğŸ”’ï¼‰éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ JWT Tokenï¼š

```http
Authorization: Bearer <your_access_token>
```

**Token è¿‡æœŸå¤„ç†**:

1. ä½¿ç”¨ `POST /v1/auth/refresh` æ¥å£åˆ·æ–° Token
2. ä½¿ç”¨è¿”å›çš„æ–° Token ç»§ç»­è¯·æ±‚

---

## æ•°æ®æ¨¡å‹

### Snapshotï¼ˆå¿«ç…§ï¼‰

| å­—æ®µ          | ç±»å‹   | è¯´æ˜                   |
| ------------- | ------ | ---------------------- |
| `id`          | int    | å¿«ç…§ ID                |
| `verse_id`    | int    | å…³è”åœºæ™¯ ID            |
| `name`        | string | åœºæ™¯åç§°ï¼ˆæ¥è‡ª verseï¼‰ |
| `description` | string | åœºæ™¯æè¿°ï¼ˆæ¥è‡ª verseï¼‰ |
| `uuid`        | string | UUID                   |
| `code`        | string | åœºæ™¯ä»£ç                |
| `data`        | object | åœºæ™¯æ•°æ®               |
| `image`       | object | å°é¢å›¾ç‰‡               |
| `metas`       | array  | å…ƒæ•°æ®åˆ—è¡¨             |
| `resources`   | array  | èµ„æºåˆ—è¡¨               |
| `managers`    | array  | ç®¡ç†è€…åˆ—è¡¨             |
| `author_id`   | int    | ä½œè€… ID                |
| `author`      | object | ä½œè€…ä¿¡æ¯               |
| `created_at`  | string | åˆ›å»ºæ—¶é—´               |

### Tagsï¼ˆæ ‡ç­¾ï¼‰

| å­—æ®µ   | ç±»å‹   | è¯´æ˜           |
| ------ | ------ | -------------- |
| `id`   | int    | æ ‡ç­¾ ID        |
| `name` | string | æ ‡ç­¾åç§°       |
| `key`  | string | æ ‡ç­¾é”®ï¼ˆå”¯ä¸€ï¼‰ |
| `type` | string | æ ‡ç­¾ç±»å‹       |

---

## æ¥å£æ±‡æ€»æ€»æ€»

| æ–¹æ³•     | è·¯ç”±                  | è®¤è¯ | è¯´æ˜         |
| -------- | --------------------- | ---- | ------------ |
| POST     | `/v1/auth/login`      | âŒ   | ç™»å½•         |
| POST     | `/v1/auth/refresh`    | âŒ   | åˆ·æ–° Token   |
| GET/HEAD | `/v1/server/test`     | âŒ   | æµ‹è¯•æ¥å£     |
| GET      | `/v1/server/public`   | âŒ   | å…¬å¼€åœºæ™¯åˆ—è¡¨ |
| GET      | `/v1/server/checkin`  | âŒ   | æ‰“å¡åœºæ™¯åˆ—è¡¨ |
| GET      | `/v1/server/snapshot` | âŒ   | å•ä¸ªå¿«ç…§     |
| GET      | `/v1/server/tags`     | âŒ   | æ ‡ç­¾åˆ—è¡¨     |
| GET      | `/v1/server/private`  | âœ…   | ç§æœ‰åœºæ™¯åˆ—è¡¨ |
| GET      | `/v1/server/group`    | âœ…   | ç»„åœºæ™¯åˆ—è¡¨   |
